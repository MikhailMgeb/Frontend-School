<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Телефона-телефона</title>
  <link rel="stylesheet" href="https://cdn.rawgit.com/Chalarangelo/mini.css/v3.0.1/dist/mini-default.min.css" />
  <link rel="stylesheet" href="/node_modules/intl-tel-input/build/css/intlTelInput.min.css">
  <link rel="stylesheet" href="./style.css">
</head>

<body class="page">
  <h2>Телефона-телефона</h2>
  <input class="phone" type="tel">
  <button id="btn" type="button">Validate</button>
  <span id="valid-msg" class="hide">✓ Valid</span>
  <span id="error-msg" class="hide"></span>
</body>

<script src="./node_modules/intl-tel-input/build/js/intlTelInput.min.js"></script>
<script>
  const input = document.querySelector('.phone');
  window.intlTelInput(input, {
    onlyCountries: ["al", "ad", "at", "by", "be", "ba", "bg", "hr", "cz", "dk",
      "ee", "fo", "fi", "fr", "de", "gi", "gr", "va", "hu", "is", "ie", "it", "lv",
      "li", "lt", "lu", "mk", "mt", "md", "mc", "me", "nl", "no", "pl", "pt", "ro",
      "ru", "sm", "rs", "sk", "si", "es", "se", "ch", "ua", "gb"],
    utilsScript: "./node_modules/intl-tel-input/build/js/utils.js"
  });

  const button = document.querySelector("#btn");
  const errorMsg = document.querySelector("#error-msg");
  const validMsg = document.querySelector("#valid-msg");

  const errorMap = ["Invalid number", "Invalid country code", "Too short", "Too long", "Invalid number"];

  const iti = window.intlTelInput(input, {
    utilsScript: "./node_modules/intl-tel-input/build/js/utils.js"
  });

  const reset = () => {
    input.classList.remove("error");
    errorMsg.innerHTML = "";
    errorMsg.classList.add("hide");
    validMsg.classList.add("hide");
  };

  button.addEventListener('click', () => {
    reset();
    if (input.value.trim()) {
      if (iti.isPossibleNumber()) {
        validMsg.classList.remove("hide");
      } else {
        input.classList.add("error");
        const errorCode = iti.getValidationError();
        errorMsg.innerHTML = errorMap[errorCode];
        errorMsg.classList.remove("hide");
      }
    }
  });

  input.addEventListener('change', reset);
  input.addEventListener('keyup', reset);

  window.intlTelInput(input, {
  initialCountry: "auto",
  geoIpLookup: callback => {
    fetch("https://ipapi.co/json")
      .then(res => res.json())
      .then(data => callback(data.country_code))
      .catch(() => callback("us"));
  },
  utilsScript: "./node_modules/intl-tel-input/build/js/utils.js"
});

</script>

</html>